<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicRank Songs</title>

    <style>
        /* --- SPACE DARK THEME --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Inter", sans-serif;
        }
        body {
            background: #0d0f14;
            color: #e0e3e7;
            overflow-x: hidden;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 20%, rgba(80,0,255,0.18), transparent 60%),
                        radial-gradient(circle at 80% 70%, rgba(0,180,255,0.15), transparent 60%);
            pointer-events: none;
            z-index: -1;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #12141b;
            color: #fff;
            padding: 15px 25px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            backdrop-filter: blur(8px);
        }
        nav .logo {
            font-size: 26px;
            font-weight: 700;
            letter-spacing: 1px;
            background: linear-gradient(90deg, #7d53ff, #4cf8ff);
            -webkit-background-clip: text;
            color: transparent;
        }
        nav ul {
            list-style: none;
            display: flex;
            gap: 20px;
        }
        nav ul li a {
            color: #9fb4c9;
            text-decoration: none;
            transition: .2s;
        }
        nav ul li a:hover {
            color: #ffffff;
        }

        .hero {
            padding: 60px 20px;
            text-align: center;
            background: #12141b;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        .hero h1 {
            font-size: 38px;
            font-weight: 800;
            background: linear-gradient(90deg, #8b55ff, #4cf8ff);
            -webkit-background-clip: text;
            color: transparent;
        }
        .hero p {
            opacity: .75;
            font-size: 17px;
            margin-top: 10px;
        }
        .hero input[type="text"] {
            padding: 12px 18px;
            width: 80%;
            max-width: 430px;
            margin-top: 25px;
            border: none;
            border-radius: 10px;
            background: #1b1e27;
            color: #e0e3e7;
            box-shadow: 0 0 12px rgba(120,75,255,0.3);
            outline: none;
            transition: 0.2s;
        }

        section h2 {
            font-size: 26px;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #8b55ff, #4cf8ff);
            -webkit-background-clip: text;
            color: transparent;
        }

        .game-card {
            background: #161921;
            margin-bottom: 20px;
            padding: 18px;
            border-radius: 14px;
            box-shadow: 0 0 18px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.25s;
        }

        .game-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 0 30px rgba(122,64,255,0.45);
            outline: 2px solid rgba(122,64,255,0.12);
        }

        .game-card h3 {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
        }
        .game-card h3 img {
            height: 34px;
            width: auto;
        }

        .star {
            font-size: 22px;
            margin-right: 3px;
            color: #555c6b;
            cursor: pointer;
            transition: 0.15s;
        }
        .star.selected {
            color: gold;
        }
        .star.avg {
            cursor: default;
        }

        .avg-stars {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.06);
            font-size: 15px;
        }

        footer {
            text-align: center;
            padding: 30px;
            margin-top: 40px;
            background: #12141b;
            color: #9fb4c9;
            border-top: 1px solid rgba(255,255,255,0.07);
        }

        main {
            padding: 25px;
        }
        #search-results,
        #picks-list {
            display: grid;
            gap: 16px;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
    </style>
</head>

<body>

    <nav>
        <div class="logo">MusicRank Songs</div>
        <ul>
            <li><a href="#picks">Picks</a></li>
        </ul>
    </nav>

    <header class="hero">
        <h1>Rate Your Favourite Songs</h1>
        <p>Search over 500+ songs. Powered by community ratings.</p>
        <input type="text" id="search" placeholder="Search songs...">
    </header>

    <main>
        <section id="search-results"></section>

        <section id="picks">
            <h2>MusicRank Songs Picks</h2>
            <div id="picks-list"></div>
        </section>
    </main>

    <footer>
        © 2025 MusicRank Songs — Community Song Ratings
        <br><br>
        Done Rating Your Favorite Songs? Check Out 
        <a href="https://playrankgames.github.io/games/" target="_blank" style="color:#4cf8ff; text-decoration:none;">
            PlayRank Games!
        </a>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getDatabase, ref, runTransaction, onValue, off } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCElu0rPnRHfd3ocbzBCyvZcuCnjkz9-Xo",
            authDomain: "playrank-games.firebaseapp.com",
            projectId: "playrank-games",
            storageBucket: "playrank-games.firebasestorage.app",
            messagingSenderId: "856773881474",
            appId: "1:856773881474:web:1f684733880bbbe96c4e9b",
            measurementId: "G-39MPF1BWMC",
            databaseURL: "https://playrank-games-default-rtdb.firebaseio.com/"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let votedLocal = JSON.parse(localStorage.getItem("votedLocal")) || {};
        function saveLocal() {
            localStorage.setItem("votedLocal", JSON.stringify(votedLocal));
        }

        const picks = [
            { name: "Loser", logo: "https://images.genius.com/f0f06bb4bff03dc7f59003e0e367c1eb.1000x1000x1.png" },
            { name: "I Wonder", logo: "https://mcdn.wallpapersafari.com/medium/49/80/ZhOawY.jpg" },
            { name: "Gone Gone Thankyou", logo: "https://i1.sndcdn.com/artworks-zcwN7oGZMjBL-0-t1080x1080.jpg" },
            { name: "Black And Yellow", logo: "https://i.scdn.co/image/ab67616d0000b273117ad8c714eeb4cf950101d5" },
            { name: "Border Line", logo: "https://f4.bcbits.com/img/a2986052841_10.jpg" },
            { name: "See You Again", logo: "https://i.scdn.co/image/ab67616d0000b2738940ac99f49e44f59e6f7fb3" },
            { name: "Daylight", logo: "https://is1-ssl.mzstatic.com/image/thumb/Music126/v4/2e/a7/75/2ea77552-aa74-8cf1-4765-0529f6080c26/23SYMIM03701.rgb.jpg/1200x1200bf-60.jpg" },
            { name: "Heartbeat", logo: "https://i1.sndcdn.com/artworks-000387373029-c97apx-t500x500.jpg" },
            { name: "Tore Up", logo: "https://images.genius.com/536789345610c9f70510170a9fed1c79.1000x1000x1.png" },
            { name: "Thunderstruck", logo: "https://i.pinimg.com/originals/3b/c9/e8/3bc9e87e6f4fed1d3b95fb4c8d091db0.png" }
        ];

        const allGames = [
            "Bohemian Rhapsody", "Hotel California", "Stairway to Heaven", "Billie Jean", "Like a Rolling Stone", "Smells Like Teen Spirit",
        ];

        allGames.sort((a, b) => a.localeCompare(b));

        function createCard(name, logo = null) {
            const card = document.createElement("div");
            card.className = "game-card";
            const id = name.replace(/\s+/g, '');

            card.innerHTML = `
                <h3>${logo ? `<img src="${logo}" alt="${name} logo">` : ""}${name}</h3>
                <div class="avg-stars" id="avg-${id}">Loading...</div>
                <div class="rating" id="rate-${id}"></div>
            `;

            const ratingDiv = card.querySelector(`#rate-${id}`);

            if (!votedLocal[name]) {
                for (let i = 1; i <= 10; i++) {
                    const s = document.createElement("span");
                    s.className = "star";
                    s.textContent = "★";
                    s.dataset.value = i;

                    s.onclick = async () => {
                        if (votedLocal[name]) return;

                        votedLocal[name] = true;
                        saveLocal();

                        const gameRef = ref(db, "ratings/" + name);

                        await runTransaction(gameRef, current => {
                            if (!current) return { avg: i, count: 1 };
                            const newCount = (current.count || 0) + 1;
                            const newAvg = ((current.avg * current.count) + i) / newCount;
                            return { avg: newAvg, count: newCount };
                        });

                        render();
                    };

                    ratingDiv.appendChild(s);
                }
            }

            const avgDiv = card.querySelector(`#avg-${id}`);
            const gameRef = ref(db, "ratings/" + name);

            onValue(gameRef, snap => {
                if (!snap.exists()) {
                    avgDiv.textContent = "No ratings yet";
                    return;
                }

                const data = snap.val();
                const avg = parseFloat(data.avg || 0);
                const count = data.count || 0;

                let stars = "";
                for (let j = 1; j <= 10; j++) {
                    stars += `<span class="star avg" style="color:${j <= avg ? "gold" : "#444"}">★</span>`;
                }

                avgDiv.innerHTML = `
                    ${stars}
                    <strong>${avg.toFixed(1)}</strong>/10 (${count} vote${count === 1 ? "" : "s"})
                `;
            });

            return card;
        }

        function render() {
            const query = document.getElementById("search").value.toLowerCase().trim();
            const results = document.getElementById("search-results");

            results.innerHTML = "";
            if (query) {
                const match = allGames.filter(g => g.toLowerCase().includes(query));
                match.forEach(name => results.appendChild(createCard(name)));
            }

            const picksList = document.getElementById("picks-list");
            picksList.innerHTML = "";

            picks.forEach(p => picksList.appendChild(createCard(p.name, p.logo)));
        }

        document.getElementById("search").addEventListener("input", render);
        window.addEventListener("DOMContentLoaded", render);
    </script>

</body>
</html>
